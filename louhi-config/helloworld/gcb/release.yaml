# substitutions:
#   # _SRC_DIR and _REV are populated automatically by Louhi (from the
#   # "artifacts:" YAML key in flow.yaml).
#   _SRC_DIR: "%OPERATION.CHECKOUT_DIR"
#   _REV: "%OPERATION.REVISION"

timeout: '21600s'

# tags:
# - 'helloworld'
# - 'release'

steps:
# # Compile binary and build Docker image. The build script that comes with
# # helloworld first compiles the Go binary and then containerizes it inside a
# # Docker image.
# - name: k8s.gcr.io/addon-builder
#   id: build
#   entrypoint: 'bash'
#   dir: '${_SRC_DIR}'
#   args:
#   - '-c'
#   - |
#     set -ex
#     echo building $_REV
#     PUSH_REGISTRY=gcr.io/$PROJECT_ID ./build.sh

# # Test the image. Ideally this would invoke some unit tests.
# - name: k8s.gcr.io/addon-builder
#   id: test
#   entrypoint: 'bash'
#   dir: '${_SRC_DIR}'
#   args:
#   - '-c'
#   - |
#     set -ex
#     ./test.sh

# - name: gcr.io/cloud-marketplace/google/rbe-ubuntu16-04@sha256:9bd8ba020af33edb5f11eff0af2f63b3bcb168cd6566d7b27c6685e717787928
#   id: lsStep
#   # entrypoint: '/bin/bash'
#   args: ['echo', 'hello world!!!']

# - name: 'gcr.io/cloud-builders/bazel@sha256:e99cdd0fd414e5a7745ba517a026911e6c9673433df53a2c0a007d3900879a5b'
#   id: 'bazelVersionCheck'
#   entrypoint: 'bash'
#   args: ['bazel', 'version']

  - name: 'gcr.io/cloud-builders/bazel@sha256:e99cdd0fd414e5a7745ba517a026911e6c9673433df53a2c0a007d3900879a5b'
    args:
    - 'bazel'
    - 'version'
    id: 'version'
    waitFor:
    - "-" # wait for nothing - start immediately
